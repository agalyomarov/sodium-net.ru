var mongoose         = require('mongoose');
var Faker            = require('Faker');
var DatabaseCleaner  = require('database-cleaner');

var dbConnection = 'mongodb://127.0.0.1/testing';

module.exports.setDb = function (fn) {
    mongoose.connect(dbConnection);
    var db = mongoose.connection;
    db.on('error', console.error.bind(console, 'connection error:'));
    mongoose.connection.db.once('open', function(err, db) {
        fn();
    });
};

module.exports.cleanDb = function (fn) {
    var databaseCleaner = new DatabaseCleaner('mongodb');
    databaseCleaner.clean(mongoose.connection.db, function () {
        mongoose.connection.close(function () {
            mongoose.disconnect(function () {
                fn();
            });
        });
    });
};
